<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<title>
  
    Developer Guide: Common Patterns
  
</title>

<meta name="description" content="Here are some patterns and techniques I have found useful in creating more sophisticated visualizations. These currently apply to 2D contexts, since I have not created any 3D ones yet.
Getting the Vol">
<meta property="og:type" content="website">
<meta property="og:title" content="Developer Guide: Common Patterns">
<meta property="og:url" content="http://michaelbromley.github.io/skqw/common-patterns/index.html">
<meta property="og:site_name" content="SKQW">
<meta property="og:description" content="Here are some patterns and techniques I have found useful in creating more sophisticated visualizations. These currently apply to 2D contexts, since I have not created any 3D ones yet.
Getting the Vol">
<meta property="og:image" content="http://michaelbromley.github.io/skqw/skqw/images/screenshot-01.jpg">
<meta property="og:updated_time" content="2016-08-27T19:20:42.643Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Developer Guide: Common Patterns">
<meta name="twitter:description" content="Here are some patterns and techniques I have found useful in creating more sophisticated visualizations. These currently apply to 2D contexts, since I have not created any 3D ones yet.
Getting the Vol">
<meta name="twitter:image" content="http://michaelbromley.github.io/skqw/skqw/images/screenshot-01.jpg">
<meta name="twitter:creator" content="@michlbrmly">


  <link rel="alternative" href="/atom.xml" title="SKQW" type="application/atom+xml">



  <link rel="icon" href="images/favicon.ico">


<link rel="stylesheet" href="/skqw/styles/main.css">




</head>
<body
        
        class="monochrome"
        
>
<div class="mobile-header">
  <button class="sidebar-toggle" type="button">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="title" href="/skqw/">
    <img src="/skqw/images/logo-line.svg" class="mobile-header-logo">
  </a>
</div>

<div class="main-container">
  <div class="sidebar">
  <div class="header">
    <a href="/skqw/">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="597" height="197" class="logo" viewBox="0 0 597 197" preserveAspectRatio="xMidYMid meet">
  <rect id="backgroundrect" width="100%" height="100%" x="0" y="0" fill="none" stroke="none"/>
    <g transform="translate(-96.146 -485.097)"  stroke="#4fd6cb" fill="none">
        <path d="M511.482 492.87v159.604l90.712-159.464z"  />
        <path d="M590.703 522.98l16-29.564h76.566l-33.485 57.994-58.624 101.54z"  />
        <path d="M383.643 644.29l87.6-151.727H395.07l-11.116 19.256z"  />
        <path d="M476.5 620.352l-27.972 48.45h28.686z"  />
        <path d="M249.643 644.29l87.6-151.727h-87.6z"  />
        <path d="M250 653.22l52.28-90.554 48.023 89.91z"  />
        <path d="M140.36 601.368l-34.84-60.34 27.974-48.45h68.76z"  stroke-width="1.013" />
        <path d="M384.357 653.22l92.26-159.798v103.012L443.783 653.3z"  />
        <path d="M178.854 543.765l34.838 60.34-27.973 48.45h-68.76z"  stroke-width="1.013" />
    </g>
</svg>

    </a>
    <div class="info">
      <div class="content">
        
      </div>
    </div>
  </div>
  <div class="body">
    
    
    <ul class="nav">
      
      

      
      <li class="section-title">
        <span>User Guide</span>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/getting-started" title="Getting Started">Getting Started</a>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/how-to" title="How To Guides">How To Guides</a>
      </li>
      
      
      
    </ul>
    
    <ul class="nav">
      
      

      
      <li class="section-title">
        <span>Developer Guide</span>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/developer-guide-getting-started" title="Getting Started">Getting Started</a>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/parameters" title="Parameters">Parameters</a>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/common-patterns" title="Common Patterns">Common Patterns</a>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/using-three-js" title="Using Three.js">Using Three.js</a>
      </li>
      
      
      
      

      
      <li>
        <a href="/skqw/api-reference" title="API Reference">API Reference</a>
      </li>
      
      
      
    </ul>
    
    <ul class="nav">
      
      

      
      <li class="section-title">
        <span>Links</span>
      </li>
      
      
      
      

      
      <li>
        <a href="https://github.com/michaelbromley/skqw" title="SKQW on Github" target="_blank" rel="external">SKQW on Github</a>
      </li>
      
      
      
      

      
      <li>
        <a href="https://twitter.com/michlbrmly" title="@michlbrmly" target="_blank" rel="external">@michlbrmly</a>
      </li>
      
      
      
    </ul>
    
    
  </div>
</div>

  <div class="main-content">
    
    <div style="max-width: 800px">
      
      <article id="page-undefined" class="article article-type-page">
  
    <h1 class="article-header">
      Developer Guide: Common Patterns
    </h1>
  
  

  <div class="article-info">
    <span class="article-date">
  Updated: 2016-08-27
</span>

    

    

  </div>
  <div class="article-entry">
    <p>Here are some patterns and techniques I have found useful in creating more sophisticated visualizations. These currently apply to 2D contexts, since I have not created any 3D ones yet.</p>
<h2 id="Getting-the-Volume"><a href="#Getting-the-Volume" class="headerlink" title="Getting the Volume"></a>Getting the Volume</h2><p>It is often useful to calculate the overall volume of the signal. This is a simple matter of adding up all the values of the <code>ft</code> array:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params">skqw</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> ft = skqw.sample.ft;</div><div class="line">  </div><div class="line">  <span class="comment">// Here is a procedural approach to calculating the volume.</span></div><div class="line">  <span class="keyword">const</span> volume1 = <span class="number">0</span>;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; ft.length; i ++) &#123;</div><div class="line">      volume1 += ft[i];</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// Here is a more functional approach. Performance may be worse, but </span></div><div class="line">  <span class="comment">// that probably won't matter.</span></div><div class="line">  <span class="keyword">const</span> volume2 = ft.reduce((a, b) =&gt; a + b);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Damping"><a href="#Damping" class="headerlink" title="Damping"></a>Damping</h2><p>The audio signal often fluctuates rapidly. Directly mapping those changes to a visualization can result in an unpleasantly jerky experience.</p>
<p>Damping can be used to smooth out the rapid fluctuations and give a smoother signal with which to work. Here is one way to do that:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> dampedVolume = <span class="number">0</span>;</div><div class="line"><span class="comment">// A higher value gives a smoother but slower response to</span></div><div class="line"><span class="comment">// changes in the signal value.</span></div><div class="line"><span class="keyword">const</span> dampingFactor = <span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params">skqw</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> ft = skqw.sample.ft;</div><div class="line">  </div><div class="line">  <span class="keyword">const</span> volume = ft.reduce((a, b) =&gt; a + b);</div><div class="line">  <span class="keyword">const</span> delta = volume - dampedVolume;</div><div class="line">  dampedVolume += delta / dampingFactor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Multiple-Canvases"><a href="#Multiple-Canvases" class="headerlink" title="Multiple Canvases"></a>Multiple Canvases</h2><p>SKQW allows you to create as many canvases as you like, and they will be layered on top of one another. This can be useful, for instance, when you want one layer to use a different blend mode than another, or have one canvas update at a different frame rate than another.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> backgroundCtx;</div><div class="line"><span class="keyword">let</span> foregroundCtx;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">skqw</span>) </span>&#123;</div><div class="line">  backgroundCtx = skqw.createCanvas().getContext(<span class="string">'2d'</span>);</div><div class="line">  foregroundCtx = skqw.createCanvas().getContext(<span class="string">'2d'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Off-Screen-Buffer-Canvas"><a href="#Off-Screen-Buffer-Canvas" class="headerlink" title="Off-Screen Buffer Canvas"></a>Off-Screen Buffer Canvas</h2><p>A canvas element may be created but never rendered to directly, but rather used as a buffer for the main canvas. This can allow a couple of advanced techniques:</p>
<ol>
<li>Setting the alpha on a frame, rather than clearing it completely.</li>
<li>Transforming a frame and overlaying the transform on the next frame.</li>
</ol>
<p>This technique is used, for example, in the default “SKQW” visualization to create the “waterfall” effect.</p>
<p>A buffer canvas is not created with <code>skqw.createCanvas()</code> since we do not intend to render to it directly:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> ctx;</div><div class="line"><span class="keyword">let</span> ctxBuffer;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">skqw</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> &#123; width, height &#125; = skqw.dimensions;</div><div class="line">  </div><div class="line">  ctx = skqw.createCanvas().getContext(<span class="string">'2d'</span>);</div><div class="line">  </div><div class="line">  <span class="comment">// the buffer is created with the regular DOM API.</span></div><div class="line">  ctxBuffer = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>).getContext(<span class="string">'2d'</span>);</div><div class="line">  </div><div class="line">  <span class="comment">// we need to manually manage the dimensions of the buffer, since</span></div><div class="line">  <span class="comment">// SKQW does not know about it.</span></div><div class="line">  ctxBuffer.canvas.width = width;</div><div class="line">  ctxBuffer.canvas.height = height;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tick</span>(<span class="params">skqw</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> &#123; width, height &#125; = skqw.dimensions;</div><div class="line"></div><div class="line">  ctxBuffer.save();</div><div class="line">  ctxBuffer.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">  ctxBuffer.globalAlpha = <span class="number">0.8</span>;</div><div class="line">  <span class="comment">// set up a translation to apply to the buffer (move it down </span></div><div class="line">  <span class="comment">// by one pixel in this case)</span></div><div class="line">  ctxBuffer.translate(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">  <span class="comment">// copy the main canvas to the buffer</span></div><div class="line">  ctxBuffer.drawImage(ctx.canvas, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">  <span class="comment">// clear the main canvas as usual</span></div><div class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">  <span class="comment">// copy the transformed buffer back to the main canvas</span></div><div class="line">  ctx.drawImage(ctxBuffer.canvas, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">  ctxBuffer.restore();</div><div class="line">  </div><div class="line">  <span class="comment">// ... do the rest of the drawing</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

  </div>
  <footer class="article-footer">

  </footer>
</article>


      <div class="main-footer">
    © 2016 Michael Bromley - Powered by <a href="http://hexo.io" target="_blank">Hexo</a>
</div>

      
    </div>
    
  </div>
</div>
<script src="/skqw/scripts/main.js"></script>
</body>
</html>
